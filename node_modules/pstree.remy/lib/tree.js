const spawn = require('child_process').spawn;

<<<<<<< HEAD
module.exports = function (rootPid, callback) {
  const pidsOfInterest = new Set([parseInt(rootPid, 10)]);
=======
module.exports = function(rootPid, callback) {
  const tree = {};
>>>>>>> 0e28bf074f604058bd0f6bbed878eaa2e2cc5fc6
  var output = '';

  // *nix
  const ps = spawn('ps', ['-A', '-o', 'ppid,pid']);
<<<<<<< HEAD
  ps.stdout.on('data', (data) => {
=======
  ps.stdout.on('data', data => {
>>>>>>> 0e28bf074f604058bd0f6bbed878eaa2e2cc5fc6
    output += data.toString('ascii');
  });

  ps.on('close', () => {
    try {
      const res = output
        .split('\n')
        .slice(1)
<<<<<<< HEAD
        .map((_) => _.trim())
        .reduce((acc, line) => {
          const pids = line.split(/\s+/);
          const ppid = parseInt(pids[0], 10);

          if (pidsOfInterest.has(ppid)) {
            const pid = parseInt(pids[1], 10);
            acc.push(pid);
            pidsOfInterest.add(pid);
=======
        .map(_ => _.trim())
        .reduce((acc, line) => {
          if (line.indexOf(rootPid + ' ') === 0) {
            const pid = line.split(/\s+/).pop();
            acc.push(parseInt(pid, 10));
            rootPid = pid;
>>>>>>> 0e28bf074f604058bd0f6bbed878eaa2e2cc5fc6
          }

          return acc;
        }, []);

      callback(null, res);
    } catch (e) {
      callback(e, null);
    }
  });
};
